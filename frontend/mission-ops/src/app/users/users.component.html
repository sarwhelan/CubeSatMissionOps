<h1>Users</h1>
<table class="table">
  <thead>
    <tr>
      <th scope="col">Email</th>
      <th scope="col">Phone</th>
      <th scope="col">Status</th>
      <th scope="col">Administrator</th>
      <th scope="col">Actions</th>
    </tr>
  </thead>
  <tbody>
    <ng-container *ngIf="userList; else tableSpinner">
      <tr *ngFor="let user of userList.items">
        <td>{{user.email}}</td>
        <td>{{user.phone}}</td>
        <td>{{user.status}}</td>
        <td>
          <div class="form-check">
            <input [ngModel]="user.administrator" type="checkbox" class="form-check-input" disabled>
          </div>
        </td>
        <td>
          <a class="btn btn-primary" href="/users/edit?id={{user.id}}" role="button">Edit</a>
          <button (click)="promptDeleteUser(user)" class="btn btn-outline-danger" [attr.disabled]="auth.getCurrentUser().email === user.email ? '' : null">Delete</button>
        </td>
      </tr>
    </ng-container>
    <ng-template #tableSpinner>
      <tr>
        <td colspan="3">
          <div class="text-center">
            <div class="spinner-border" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
        </td>
      </tr>
    </ng-template>
  </tbody>
</table>

<app-pagination [maxPage]="pages" (pageChange)="pageChanged($event)"></app-pagination>

<app-modal #deleteUserModal>
  <ng-container modal-title>
    <h1>Are You Sure?</h1>
  </ng-container>
  <ng-container modal-body>
    <p>Are you sure you want to delete user <span class="text-primary">{{deletingUser?.email}}</span>?</p>
    <p>They will be deleted <span class="text-danger">permanently</span> and can never be recovered.</p>
    <p>Enter their email into the field below to confirm you want to delete them.</p>
    <input [(ngModel)]="deleteConfirm" class="form-control" type="email" placeholder="Email" name="deleteConfirm">
    <app-alert #deleteUserAlert [alertStyle]="'danger'"></app-alert>
  </ng-container>
  <ng-container modal-footer>
    <button (click)="deleteUser()" class="btn btn-danger" [attr.disabled]="deleteConfirm !== deletingUser?.email ? '' : null">
      Delete
      <span *ngIf="processing" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
    </button>
  </ng-container>
</app-modal>